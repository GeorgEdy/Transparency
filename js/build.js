/*! transparency 2016-04-21 */
function AutocompleteCtrl($timeout,$q,$log){function querySearch(query){var deferred,results=query?self.jud.filter(createFilterFor(query)):self.jud;return self.simulateQuery?(deferred=$q.defer(),$timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise):results}function searchTextChange(text){$log.info("Text changed to "+text)}function selectedItemChange(item){$log.info("Item changed to "+JSON.stringify(item))}function loadJud(){var allJud="Alba, Arad, Arges, Bacau, Bihor, Bistrita Nasaud, Botosani,              	Braila, Brasov, Bucuresti, Buzau, Calarasi, Caras Severin, Cluj,              	Constanta, Covasna, Dambovita, Dolj, Galati, Giurgiu, Gorj,              	Harghita, Hunedoara, Ialomita, Iasi, Ilfov, Maramures,              	Mehedinti, Mures, Neamt, Olt, Prahova, Salaj, Satu Mare,              	Sibiu, Suceava, Teleorman, Timis, Tulcea, Valcea, Vaslui, Vrancea";return allJud.split(/, +/g).map(function(state){return{value:state.toLowerCase(),display:state}})}function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function(state){return 0===state.value.indexOf(lowercaseQuery)}}var self=this;self.simulateQuery=!1,self.isDisabled=!1,self.jud=loadJud(),self.querySearch=querySearch,self.selectedItemChange=selectedItemChange,self.searchTextChange=searchTextChange}var app=angular.module("transparencyApp",["ngRoute","chart.js","ui.bootstrap","ngMaterial"]);app.config(function($locationProvider,$routeProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!1}),$routeProvider.when("/",{templateUrl:"Views/home.html",controller:"HomeCtrl",controllerAs:"home"}).when("/comparison",{templateUrl:"Views/comparison.html",controller:"ComparisonCtrl",controllerAs:"comparison"}).when("/filter",{templateUrl:"Views/filter.html",controller:"FilterCtrl",controllerAs:"filter"}).otherwise({redirectTo:"/"})}),app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(scope,element,attrs){scope.dialogStyle={},attrs.width&&(scope.dialogStyle.width=attrs.width),attrs.height&&(scope.dialogStyle.height=attrs.height),scope.hideModal=function(){scope.show=!1}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'><span class='glyphicon glyphicon-remove'></span></div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}),app.controller("AutocompleteCtrl",AutocompleteCtrl),app.controller("ComparisonCtrl",function($scope){}),app.controller("DatePickerCtrl",function($scope){function getDayClass(data){var date=data.date,mode=data.mode;if("day"===mode)for(var dayToCheck=new Date(date).setHours(0,0,0,0),i=0;i<$scope.events.length;i++){var currentDay=new Date($scope.events[i].date).setHours(0,0,0,0);if(dayToCheck===currentDay)return $scope.events[i].status}return""}$scope.today=function(){$scope.dt=new Date},$scope.today(),$scope.clear=function(){$scope.dt=null},$scope.inlineOptions={customClass:getDayClass,maxDate:new Date(2016,1,1),showWeeks:!1},$scope.dateOptions={"year-format":"'yy'","starting-day":1,"datepicker-mode":"'month'","min-mode":"month",maxDate:new Date(2016,1,1),minDate:new Date(2016,1,1)},$scope.open1=function(){$scope.popup1.opened=!0},$scope.setDate=function(year,month,day){$scope.dt=new Date(year,month,day)},$scope.popup1={opened:!1}}),app.controller("FilterCtrl",function($scope,DataStore){$scope.openModal=function($event){$scope.modalShown=!1,$scope.modalShown=!$scope.modalShown,$scope.runChart=function(){var venit,cheltuieli;return $scope.chartData=[0,0],angular.forEach($scope.data,function(item){var currentRow=$event.target.parentNode,dataId=currentRow.getAttribute("data-id");venit=$scope.data[dataId-1].venit,cheltuieli=$scope.data[dataId-1].cheltuieli,$scope.chartData=[]}),$scope.chartData.push(venit),$scope.chartData.push(cheltuieli),console.log($scope.chartData),$scope.chartData}},$scope.data=[],DataStore.getAll().then(function(items){$scope.data=items}),$scope.search=function(){$scope.arie=document.getElementById("arie").value,$scope.institutie=document.getElementById("institutie").value,DataStore.getSearch($scope.arie,$scope.institutie).then(function(items){$scope.data=items})},$scope.chartLabels=["Venituri","Cheltuieli"]}),app.controller("HomeCtrl",function($scope,DataStore){$scope.openModal=function(){$scope.modalShown=!1,$scope.modalShown=!$scope.modalShown},$scope.date=[],$scope.showData=function(){var incomeSum=0,outcomeSum=0;DataStore.getAll().then(function(items){return $scope.date=items,items.forEach(function(index){"Bucuresti"===index.judet&&(incomeSum+=Math.round(index.venit),outcomeSum+=Math.round(index.cheltuieli))}),document.getElementById("income-hover").innerHTML="Total venituri: "+incomeSum+"  mii lei",document.getElementById("outcome-hover").innerHTML="Total cheltuieli: "+outcomeSum+" mii lei",[incomeSum,outcomeSum]})},$scope.hideData=function(){document.getElementById("income-hover").innerHTML="",document.getElementById("outcome-hover").innerHTML=""}}),app.factory("DataStore",function($http,$q){return function(){var URL="https://intense-sierra-23176.herokuapp.com/search",getAll=function(){return $q(function(resolve,reject){$http({url:URL}).then(function(xhr){200==xhr.status?resolve(xhr.data):reject()},reject)})},getSearch=function(area,inst){return $q(function(resolve,reject){var url=URL,params="";""!==area&&(params="?area="+encodeURIComponent(area)),""!==inst&&(""!==params?params+="&inst="+encodeURIComponent(inst):params="?inst="+encodeURIComponent(inst)),url+=params,$http({url:url}).then(function(xhr){200==xhr.status?resolve(xhr.data):reject()},reject)})};return{getAll:getAll,getSearch:getSearch}}()});